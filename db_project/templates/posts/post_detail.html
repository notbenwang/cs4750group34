<h1>{{ post.title }}</h1>
<p>Community: <a href="{% url 'community_home' community_name=community.name %}">{{ community.name }}</a></p>
<p>{{ post.content }}</p>
<small>Posted on: {{ post.creation_date }}</small>

<div class="vote-box">
    <form method="post" action="{% url 'vote' post_id=post.post_id %}">
        {% csrf_token %}
        <button name="vote_type" value="upvote" type="submit">⬆️</button>
        <span>{{ post.score }}</span>
        <button name="vote_type" value="downvote" type="submit">⬇️</button>
    </form>
</div>

{% if is_owner %}
<form method="post" action="{% url 'delete_post' community_name=community.name post_id=post.post_id %}">
    {% csrf_token %}
    <button type="submit" onclick="return confirm('Are you sure you want to delete this post?')">Delete Post</button>
</form>
{% endif %}


Add Comment
<form method="post" action="{% url 'add_comment' community_name=community.name post_id=post.post_id comment_id=0 %}">
    {% csrf_token %}
    <input type ="text" name="content">
    <button type="submit">Reply</button>
</form>

{% if comment_list %}
Replies
<ul>
    {% for comment in comment_list %}
    <li>
        {{comment.indent}}{{comment.data.content}} <small>
            - {{comment.username}}, {{comment.data.creation_date}}
        </small>
        <button type="button" onclick="toggleForm({{comment.data.comment_id}})">Reply</button>
        <div id="comment-form-{{comment.data.comment_id}}" style="display: none; margin-top: 10px;">
            <form method="POST" action="{% url 'add_comment' community_name=community.name post_id=post.post_id comment_id=comment.data.comment_id %}">
                {% csrf_token %}
                &nbsp;&nbsp;&nbsp;&nbsp;{{comment.indent}}<input type="text" name="content">
                <button type="submit">Add Comment</button>
            </form>
        </div>
    </li>
    {% endfor %}
</ul>
<!-- Javascript that toggles comment replies -->
<script>
    function toggleForm(commentId) {
        const allForms = document.querySelectorAll('[id^="comment-form-"]');
        allForms.forEach(form => {
            if (form.id !== `comment-form-${commentId}`) {
                form.style.display = 'none';
            }
        });
        const form = document.getElementById(`comment-form-${commentId}`);
        form.style.display = form.style.display === "none" ? "block" : "none";
    }
    </script>
{% else %}
No Replies yet
{% endif %}



<p>
    <a href="{% url 'community_home' community_name=community.name %}">Back to {{ community.name }}</a>
</p>

<style>
    .vote-box {
        margin-top: 15px;
    }

    .vote-box form {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .vote-box button {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
    }

    .vote-box span {
        font-weight: bold;
    }
</style>